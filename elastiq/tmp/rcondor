#!/bin/bash

# Takes the condor_$1 command to exec
function RobustCondor() {
  local A=0
  local E=0
  local T=`mktemp /tmp/robust-condor-XXXXX`
  local C="$1"
  shift
  while true ; do
    condor_"$C" "$@" 2> $T
    E=$?
    if [ $E == 0 ] ; then
      rm -f $T
      return 0
    elif [ $E == 127 ] ; then
      # command not found
      return 127
    fi
    let A++
    if [ $A == 20 ] ; then
      cat $T
      rm -f $T
      return $E
    fi
    echo "Waiting $A seconds..."
    sleep $A
  done
}

#RobustCondor "$@"

for i in $@ ; do
  RobustCondor "$i"
  echo
done
