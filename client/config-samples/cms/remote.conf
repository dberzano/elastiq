#!/bin/bash

#
# cms/remote.conf -- by Dario Berzano <dario.berzano@cern.ch>
#
# Part of virtual-analysis-facility.
#
# Configuration of the remote environment for using VAF in CMS.
#

# Note: we don't set the remote PoD location here! We do it in the local file!

# Assume that cvmfs is used on the client machine
source /cvmfs/cms.cern.ch/cmsset_default.sh 2> /dev/null

# Find out directory containing that version of CMSSW. Platform is
# automatically detected by scram
Raw=$( scram list CMSSW | grep -A1 "$VafCmsswVersion" )
if [[ "$Raw" =~ (/cvmfs/cms\.cern\.ch/[A-Za-z0-9/_-]*) ]] ; then
  VafCmsswDir="${BASH_REMATCH[1]}"
fi

# Enable environment
OldPWD="$PWD"
cd "$VafCmsswDir" && eval $(scram runtime -sh)
cd "$OldPWD"
unset OldPWD

# Prepares the script for the workers environment
#WorkerEnv=$HOME/.PoD/user_worker_env.sh
#cat > "$WorkerEnv" <<_EndOfEnv_
## Some configuration here...
#_EndOfEnv_

# Sets worker environment here on master too
#source "$WorkerEnv"
